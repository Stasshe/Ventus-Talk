<!DOCTYPE html>
<html lang="jp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading</title>
    <link rel="manifest" href="../manifest.json">
    <link rel="icon" href="https://cdn.glitch.global/4c6a40f6-0654-48bd-96e4-a413b8aa1ec0/ico64.ico?v=1737435085854" type="image/png">
    <link rel="shortcut icon" href="https://cdn.glitch.global/4c6a40f6-0654-48bd-96e4-a413b8aa1ec0/ico64.ico?v=1737435085854" type="image/x-icon">
    <link rel="apple-touch-icon" href="https://cdn.glitch.global/4c6a40f6-0654-48bd-96e4-a413b8aa1ec0/f180.png?v=1737434524832">
  <script src="//cdn.jsdelivr.net/npm/eruda"></script>
    <script>eruda.init();console.log('eruda-index')</script>
    <style>
    /* HTML: <div class="loader"></div> */
body {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
}

.loader {
  width: fit-content;
  font-size: 60px;
  font-family: system-ui, sans-serif;
  font-weight: bold;
  text-transform: uppercase;
  color: #0000;
  -webkit-text-stroke: 1px #000;
  background: 
    linear-gradient(-60deg, #0000 45%, #000 0 55%, #0000 0) 
    0/300% 100% no-repeat text;
  animation: l3 0.35s linear infinite;
}

.loader:before {
  content: "Loading";
}

@keyframes l3 {
  0% { background-position: 100%; }
}
  </style>

</head>
<body>
    <!--<div id="loading-container">
        <h2>ロード中...</h2>
    </div>-->
  <div class="loader"></div>
    <script>
//if (!localStorage.getItem('condition')) {localStorage.setItem('condition', 'perfect_init');}
const CACHE_NAME = "ventus-talk-cache-v1"

function direct() {
  const userId = localStorage.getItem('userID');
  if (userId) {
    window.location.href = './talk/index.html';
  } else {
    window.location.href = './login/login.html';
  }
}

if ('serviceWorker' in navigator) {
  navigator.serviceWorker
    .register('/service-worker.js')
    .then(async reg => {
      direct();
      console.log('ServiceWorker registration successful with scope:', reg.scope);
    })
    .catch(error => {
      console.log('ServiceWorker registration failed:', error);
    });
}
    </script>
  
  <script type="module">
    /*
    import { 
    appd, app1, app2, appUsers, appInfo, getToken,
    dbdev, db1, db2, dbUsers, dbInfo, updateDoc,messaging,
    addDoc, serverTimestamp, query, reloadPage, orderBy, username, 
    setDoc, doc, getDoc, myuserId
} from '/firebase-setup.js';

  const btn = document.getElementById('notice');
  btn.addEventListener("click", function() {
            //let promise = Notification.requestPermission();
            //console.log("promise: ",promise);
            if (!("Notification" in window)) {
                // ブラウザーが通知に対応しているか調べる
                alert("このブラウザーはデスクトップ通知には対応していません。");
            } else if (Notification.permission !== "denied") {

            //if(Notification.permission !== "denied") {
                Notification.requestPermission().then((permission) => {
                    const messaging = getMessaging();
                    // Add the public key generated from the console here.
                    getToken(messaging, {vapidKey: "BKUDfUUeYgn8uWaWW1_d94Xyt03iBIHoLvyu1MNGPPrc72J2m5E3ckzxLqwHrsCQ9uJ5m-VhuHEjxquWqyKzTGE"})
                        .then((token) => {
                            if (token) {
                                // tokenを出力
                                await setDoc(doc(dbdev, 'users', "qw"), { token }, { merge: true });
                                //document.getElementById('output').textContent = `${token.Promise}`;
                                console.log( "token", token);
                                document.getElementById('output').textContent = token;
                            }else{
                                console.log('登録トークンがありません。生成する許可をリクエストします。');
                            }
                        })
                        .catch((err) => {
                            console.log('getToken Error',err);
                        });
                });
            }
  });*/
  </script>
</body>
</html>
